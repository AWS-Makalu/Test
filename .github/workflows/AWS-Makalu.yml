#----------------------------------------------------
# GitHub Action Part 1
# AWS-Makalu
#----------------------------------------------------
  
name: CI_AWS-Makalu
  
env:
  APPLICATION_NAME    : "APPLICATION_NAME"
  DEPLOY_PACKAGE_NAME : "AWS_Deploy-ver-${{ github.sha }}"
  TELEGRAM_TOKEN      : "1082481725:AAEraZTXO5Wjq4tYmT0O68KWlgUpsn0coa0"
  TELEGRAM_CHAT_ID    : "954432616"

on:                                       # Когда срабатывать
  push:
    branches: 
      - master                            # Ветка
  
jobs:
  JOB_Testing:                            # Test
    runs-on: ubuntu-latest
    steps:
    - name: Print Hello Message           # Print
      run : |
            TIME=$(date +%F_%H-%M-%S)
            echo "${TIME}"
            echo "Hello World testing:${TIME}"
            curl -s -X POST \
            https://api.telegram.org/bot${{ env.TELEGRAM_TOKEN }}/sendMessage \
            -d chat_id=${{ env.TELEGRAM_CHAT_ID }} \
            -d text="Push Master:${TIME}"

    - name: Exec few DATE !!!
      run: |
        echo "Hello Message event_name: ${{ github.event_name }}"  
        echo "Application name:${{ env.DEPLOY_PACKAGE_NAME }}"  
      
    - name: List corrent dir
      run : 11ls -la
      
    - name: Git Clone my Repo             # CHECKOUT
      uses: actions/checkout@v1
      
    - name: JOB Status
      run : echo "---${{ job.status }}"  # success
        
  JOB_Deploy:                             # Deploy
    runs-on: ubuntu-latest
    needs:   [JOB_Testing]                # Выполнить только если прошло  задание JOB_Testing
    steps:
    - name:  Print Hello Message
      run:   echo "Hello World deploy"
      
    - name:  Exec few commands
      run: |
        echo "---Deploy---"  
        TIME=$(date +%F_%H-%M-%S)
        echo "Deploy name:${TIME}_ALL_OK"  



