#----------------------------------------------------
# GitHub Action Part 1
# AWS-Makalu
# üí• ‚úÖ ‚ùå üçíüçì‚òòüåπüíö
#----------------------------------------------------
# IMAGE_ID=docker.pkg.github.com/${{ github.repository }}/${IMAGE_NAME}
name: CI_AWS-Makalu
  
env:
  APPLICATION_NAME    : "APPLICATION_NAME"
  DEPLOY_PACKAGE_NAME : "AWS_Deploy-ver-${{ github.sha }}"
  TELEGRAM_TOKEN      : "1082481725:AAEraZTXO5Wjq4tYmT0O68KWlgUpsn0coa0"
  TELEGRAM_CHAT_ID    : "954432616"

on:                                       # –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
  push:
    branches: 
      - master                            # –í–µ—Ç–∫–∞
jobs:
  JOB_CI:                            # Test
    runs-on: ubuntu-latest                # –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Linux
    steps:
    - name: Git Clone my Repo             # CHECKOUT
      uses: actions/checkout@v1

    - name: ALL ZIP
      run : zip -r ${{ env.DEPLOY_PACKAGE_NAME }}.zip ./ -x "*.git*"     
       
    - name: List corrent dir
      run : |
            ls -9la
            echo "Status:${{ job.status }}"   # success
     
    - name: If error                      # –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥ —Å –æ—à–∏–±–∫–æ–π - –≤—ã–ø–æ–ª–Ω–∏—Ç—å
      if  : failure()   
      run : |
            TIME=$(TZ=MSK-3 date "+%d.%m.%Y_%H:%M:%S")
            echo "${TIME}"
            echo "Hello World testing:${TIME}"
            curl -s -X POST \
            https://api.telegram.org/bot${{ env.TELEGRAM_TOKEN }}/sendMessage \
            -d chat_id=${{ env.TELEGRAM_CHAT_ID }} \
            -d text="‚ùå Err Masterüçí: ${TIME}" 
        
  JOB_CD:                                 # Deploy
    runs-on: ubuntu-latest                # –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Linux
    needs:  [JOB_CI]                     # –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ  –∑–∞–¥–∞–Ω–∏–µ JOB_Testing
    steps:
    - name: Deploy                        # Deploy
      run : |
            TIME=$(TZ=MSK-3 date "+%d.%m.%Y_%H:%M:%S")
            echo "${TIME}"
            echo "Hello World testing:${TIME}"
            curl -s -X POST \
            https://api.telegram.org/bot${{ env.TELEGRAM_TOKEN }}/sendMessage \
            -d chat_id=${{ env.TELEGRAM_CHAT_ID }} \
            -d text="‚òò Push Masterüçí: ${TIME}" 


